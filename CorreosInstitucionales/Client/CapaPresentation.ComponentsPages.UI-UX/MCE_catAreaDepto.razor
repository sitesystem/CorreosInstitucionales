@page "/AreasDeptos"

@attribute [Authorize]

@using System.Text.RegularExpressions;

@using CorreosInstitucionales.Shared.CapaEntities.ViewModels.Request;
@using CorreosInstitucionales.Shared.CapaEntities.ViewModels.Response;
@using CorreosInstitucionales.Shared.CapaServices.BusinessLogic.catAreasDeptosService;
@using CorreosInstitucionales.Shared.CapaServices.BusinessLogic.catEdificiosService;
@using CorreosInstitucionales.Shared.CapaServices.BusinessLogic.catPisosService;

@inject IAreaDepto servicioAreaDepto
@inject IEdificio servicioEdificio
@inject IPiso servicioPiso

<PageTitle>Catálogo de Áreas / Departamentos</PageTitle>

<SfBreadcrumb EnableActiveItemNavigation="true" EnableNavigation="false">
    <BreadcrumbItems>
        <BreadcrumbItem Text="Módulo de Catálogos" IconCss="e-icons e-settings" Disabled="true" />
        <BreadcrumbItem Text="Catálogo de Áreas / Departamentos" IconCss="e-icons e-transform" Disabled="true" />
    </BreadcrumbItems>
</SfBreadcrumb>

<h3 style="font-variant: small-caps;">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-diagram-3-fill" viewBox="0 0 18 18">
        <path fill-rule="evenodd" d="M6 3.5A1.5 1.5 0 0 1 7.5 2h1A1.5 1.5 0 0 1 10 3.5v1A1.5 1.5 0 0 1 8.5 6v1H14a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0v-1A.5.5 0 0 1 2 7h5.5V6A1.5 1.5 0 0 1 6 4.5v-1zm-6 8A1.5 1.5 0 0 1 1.5 10h1A1.5 1.5 0 0 1 4 11.5v1A1.5 1.5 0 0 1 2.5 14h-1A1.5 1.5 0 0 1 0 12.5v-1zm6 0A1.5 1.5 0 0 1 7.5 10h1a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 8.5 14h-1A1.5 1.5 0 0 1 6 12.5v-1zm6 0a1.5 1.5 0 0 1 1.5-1.5h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1a1.5 1.5 0 0 1-1.5-1.5v-1z" />
    </svg> Catálogo de Áreas / Departamentos
</h3>

<style type="text/css">

</style>

@if(oResponse != null && oResponse.Data != null)
{
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col-md-12">
                @* <span>RowIndex: @SelectedValue</span> *@
                <SfGrid ID="Grid" @ref="Grid" EnablePersistence="false" TValue="AreaDeptoViewModel" DataSource="@oResponse.Data" GridLines="Syncfusion.Blazor.Grids.GridLine.Both"
                        AllowSorting="true" AllowFiltering="true" AllowTextWrap="true"
                        AllowResizing="true" AllowPaging="true" AllowSelection="true"
                        AllowGrouping="true" AllowReordering="true"
                        AllowExcelExport="true" AllowPdfExport="true"
                        ShowColumnChooser="true" EnableHover="true"
                        SelectedRowIndex="0" ShowColumnMenu="true"
                        Height="100%" Width="100%" EnableVirtualMaskRow="false" EnableVirtualization="false" EnableColumnVirtualization="false"
                        RowHeight="@GridRowHeight" EnableStickyHeader="true"
                        Toolbar="@(new List<object>() { new ItemModel() { Id = "Grid_add", Text = "Agregar", TooltipText = "Agregar", PrefixIcon = "e-add", CssClass = "e-txt-casing" },
                                                        new ItemModel() { Id = "Grid_edit", Text = "Editar", TooltipText = "Editar", PrefixIcon = "e-edit", CssClass = "e-txt-casing" },
                                                        new ItemModel() { Id = "Grid_cancel", Text = "Cancelar", TooltipText = "Cancelar", PrefixIcon = "e-cancel" },
                                                        new ItemModel() { Id = "Grid_update", Text = "Guardar", TooltipText = "Actualizar", PrefixIcon = "e-update" },
                                                        new ItemModel() { Id = "", Text = "|", TooltipText = "", PrefixIcon = "" },
                                                        new ItemModel() { Id = "Grid_enable", Text = "Habilitar", TooltipText = "Activar", PrefixIcon = "e-check-box", CssClass = "e-success" },
                                                        new ItemModel() { Id = "Grid_disable", Text = "Deshabilitar", TooltipText = "Desactivar", PrefixIcon = "e-trash", CssClass = "e-danger" },
                                                        new ItemModel() { Id = "", Text = "|", TooltipText = "", PrefixIcon = "" },
                                                        new ItemModel() { Id = "Grid_excelexport", Text = "Excel", TooltipText = "Exportar a Excel", PrefixIcon = "e-excelexport" },
                                                        // new ItemModel() { Id = "Grid_csvexport", Text = "CSV", TooltipText = "Exportar a CSV", PrefixIcon = "e-csvexport" },
                                                        new ItemModel() { Id = "Grid_pdfexport", Text = "PDF", TooltipText = "Exportar a PDF", PrefixIcon = "e-pdfexport" },
                                                        new ItemModel() { Id = "copyheader", Text = "Copiar con Encabezado", TooltipText = "Copiar con Encabezado", PrefixIcon = "e-copy" },
                                                        new ItemModel { Id = "small", PrefixIcon = "e-line-very-small", Align = ItemAlign.Right, TooltipText="20px" },
                                                        new ItemModel { Id = "medium", PrefixIcon = "e-line-small", Align = ItemAlign.Right, TooltipText="40px" },
                                                        new ItemModel { Id = "big", PrefixIcon = "e-line-normal", Align = ItemAlign.Right, TooltipText="60px" },
                                                        "ColumnChooser",
                                                        "Search" })"
                        ContextMenuItems="@(new List<object>() { "AutoFit", "AutoFitAll", "SortAscending", "SortDescending",
                                                                 "Copy",
                                                                 "Edit", "Delete", "Save", "Cancel",
                                                                 "PdfExport", "ExcelExport", "CsvExport",
                                                                 "FirstPage", "PrevPage","LastPage", "NextPage"})">
                    <GridSearchSettings Operator="Syncfusion.Blazor.Operator.Contains" IgnoreAccent="true" IgnoreCase="true" />
                    <GridGroupSettings ShowGroupedColumn="true" ShowDropArea="true" />
                    <GridEvents ExcelQueryCellInfoEvent="ExcelQueryCellInfoHandler"
                                PdfQueryCellInfoEvent="PdfQueryCellInfoHandler"
                                ExportComplete="ExportCompleteHandler"
                                OnToolbarClick="ToolbarClick"
                                TValue="AreaDeptoViewModel"
                                OnActionBegin="OnActionBeginHandler"
                                OnActionComplete="OnActionCompleteHandler"
                                RowSelected="GetSelectedRecords"
                                RowDeselected="GetDeselectedRecords"
                                CommandClicked="OnCommandClicked" />
                    <GridFilterSettings Type="@Syncfusion.Blazor.Grids.FilterType.Excel" />
                    <GridSelectionSettings Type="Syncfusion.Blazor.Grids.SelectionType.Multiple"
                                           PersistSelection="true"
                                           Mode="Syncfusion.Blazor.Grids.SelectionMode.Both"
                                           CheckboxMode="CheckboxSelectionType.ResetOnRowClick"
                                           CheckboxOnly="false"
                                           EnableToggle="false"
                                           EnableSimpleMultiRowSelection="true" />
                    <GridPageSettings PageCount="5" PageSize="10" PageSizes="@(new object[] { 5, 10, 25, 50, 100, "All" })" />
                    @if (!EditModeSelection)
                    {
                        <GridEditSettings AllowAdding="true" AllowEditing="true" AllowDeleting="true"
                                          Mode="Syncfusion.Blazor.Grids.EditMode.Dialog"
                                          ShowDeleteConfirmDialog="false">
                            <Validator>
                                <DataAnnotationsValidator />
                            </Validator>
                        </GridEditSettings>
                    }
                    else
                    {
                        <GridEditSettings AllowAdding="true" AllowEditing="true" AllowDeleting="true"
                                          Mode="Syncfusion.Blazor.Grids.EditMode.Normal"
                                          ShowDeleteConfirmDialog="false">
                            <Validator>
                                <DataAnnotationsValidator />
                            </Validator>
                        </GridEditSettings>
                    }
                    <GridColumns>
                        <GridColumn Type="Syncfusion.Blazor.Grids.ColumnType.CheckBox"
                                    HeaderTextAlign="@Syncfusion.Blazor.Grids.TextAlign.Center"
                                    TextAlign="Syncfusion.Blazor.Grids.TextAlign.Center"
                                    Width="50px">
                        </GridColumn>

                        <GridColumn Field=@nameof(AreaDeptoViewModel.IdAreaDepto)
                                    HeaderText="ID"
                                    HeaderTextAlign="@Syncfusion.Blazor.Grids.TextAlign.Center"
                                    TextAlign="Syncfusion.Blazor.Grids.TextAlign.Center"
                                    IsPrimaryKey="true"
                                    IsIdentity="true"
                                    ValidationRules="@(new Syncfusion.Blazor.Grids.ValidationRules { Required = true, Number = true })"
                                    Visible="false"
                                    Width="50px">
                            <HeaderTemplate>
                                <div>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-key" viewBox="0 0 16 16">
                                        <path d="M0 8a4 4 0 0 1 7.465-2H14a.5.5 0 0 1 .354.146l1.5 1.5a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0L13 9.207l-.646.647a.5.5 0 0 1-.708 0L11 9.207l-.646.647a.5.5 0 0 1-.708 0L9 9.207l-.646.647A.5.5 0 0 1 8 10h-.535A4 4 0 0 1 0 8zm4-3a3 3 0 1 0 2.712 4.285A.5.5 0 0 1 7.163 9h.63l.853-.854a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.793-.793-1-1h-6.63a.5.5 0 0 1-.451-.285A3 3 0 0 0 4 5z" />
                                        <path d="M4 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0z" />
                                    </svg> ID
                                </div>
                            </HeaderTemplate>
                        </GridColumn>

                        <GridColumn Field=@nameof(AreaDeptoViewModel.AreNombre)
                                    HeaderText="Nombre del Área / Departamento"
                                    HeaderTextAlign="@Syncfusion.Blazor.Grids.TextAlign.Center"
                                    TextAlign="Syncfusion.Blazor.Grids.TextAlign.Left"
                                    EditType="EditType.DefaultEdit"
                                    EditorSettings="@(new StringEditCellParams { Params = new TextBoxModel() { EnableRtl = false, Readonly = false, ShowClearButton = true, Multiline = true } })"
                                    ClipMode="Syncfusion.Blazor.Grids.ClipMode.EllipsisWithTooltip"
                                    Width="150px">
                            <HeaderTemplate>
                                <div>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-diagram-3-fill" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M6 3.5A1.5 1.5 0 0 1 7.5 2h1A1.5 1.5 0 0 1 10 3.5v1A1.5 1.5 0 0 1 8.5 6v1H14a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0v-1A.5.5 0 0 1 2 7h5.5V6A1.5 1.5 0 0 1 6 4.5v-1zm-6 8A1.5 1.5 0 0 1 1.5 10h1A1.5 1.5 0 0 1 4 11.5v1A1.5 1.5 0 0 1 2.5 14h-1A1.5 1.5 0 0 1 0 12.5v-1zm6 0A1.5 1.5 0 0 1 7.5 10h1a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 8.5 14h-1A1.5 1.5 0 0 1 6 12.5v-1zm6 0a1.5 1.5 0 0 1 1.5-1.5h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1a1.5 1.5 0 0 1-1.5-1.5v-1z" />
                                    </svg> Nombre del Área / Departamento
                                </div>
                            </HeaderTemplate>
                            <Template>
                                @{
                                    var áreaDepto = (context as AreaDeptoViewModel).AreNombre;
                                }
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-diagram-2" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M6 3.5A1.5 1.5 0 0 1 7.5 2h1A1.5 1.5 0 0 1 10 3.5v1A1.5 1.5 0 0 1 8.5 6v1H11a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0v-1A.5.5 0 0 1 5 7h2.5V6A1.5 1.5 0 0 1 6 4.5v-1zM8.5 5a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1zM3 11.5A1.5 1.5 0 0 1 4.5 10h1A1.5 1.5 0 0 1 7 11.5v1A1.5 1.5 0 0 1 5.5 14h-1A1.5 1.5 0 0 1 3 12.5v-1zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zm4.5.5a1.5 1.5 0 0 1 1.5-1.5h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1A1.5 1.5 0 0 1 9 12.5v-1zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1z" />
                                </svg> @áreaDepto
                            </Template>
                            <EditTemplate>
                                @{
                                    var áreaDepto = (context as AreaDeptoViewModel);
                                    // onkeypress="return /^[a-zA-Z.áéíóúÁÉÍÓÚ ]+$/.test(String.fromCharCode(event.keyCode || event.which));"

                                    <SfAutoComplete ID="Data___AreNombre"
                                                    TValue="string"
                                                    TItem="AreaDeptoViewModel"
                                                    Placeholder="Nombre del Área / Departamento"
                                                    FloatLabelType="FloatLabelType.Always"
                                                    ShowClearButton="true"
                                                    ShowPopupButton="true"
                                                    AllowFiltering="true"
                                                    EnableVirtualization="false"
                                                    IgnoreCase="true"
                                                    Highlight="true"
                                                    Autofill="true"
                                                    MinLength="1"
                                                    IgnoreAccent="true"
                                                    SortOrder="Syncfusion.Blazor.DropDowns.SortOrder.Ascending"
                                                    FilterType="Syncfusion.Blazor.DropDowns.FilterType.Contains"
                                                    SuggestionCount="1000"
                                                    @bind-Value="@(áreaDepto.AreNombre)"
                                                    DataSource="@oResponse.Data"
                                                    OnInput="@((e) => áreaDepto.AreNombre = e.Value.ToString().ToUpper())"
                                                    ValidateOnInput="true"
                                                    PopupHeight="300px" PopupWidth="300px">
                                        <AutoCompleteFieldSettings Text="AreNombre" Value="AreNombre" />
                                    </SfAutoComplete>
                                    <ValidationMessage For="() => (áreaDepto.AreNombre)" />
                                }
                            </EditTemplate>
                        </GridColumn>
                        <GridColumn Field=@nameof(AreaDeptoViewModel.AreExtension)
                                    HeaderText="Extensiones"
                                    HeaderTextAlign="@Syncfusion.Blazor.Grids.TextAlign.Center"
                                    TextAlign="Syncfusion.Blazor.Grids.TextAlign.Center"
                                    EditType="EditType.DefaultEdit"
                                    EditorSettings="@(new StringEditCellParams { Params = new TextBoxModel() { EnableRtl = false, Readonly = true, ShowClearButton = true, Multiline = false }})"
                                    ValidationRules="@(new Syncfusion.Blazor.Grids.ValidationRules { Required = false } )"
                                    Width="50px">
                            <HeaderTemplate>
                                <div>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-telephone-fill" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z" />
                                    </svg> Extensiones
                                </div>
                            </HeaderTemplate>
                            <Template>
                                @{
                                    var extensiones = (context as AreaDeptoViewModel).AreExtension;
                                }
                                <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" fill="currentColor" class="bi bi-telephone" viewBox="0 0 16 16">
                                    <path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122l-2.19.547a1.745 1.745 0 0 1-1.657-.459L5.482 8.062a1.745 1.745 0 0 1-.46-1.657l.548-2.19a.678.678 0 0 0-.122-.58L3.654 1.328zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z" />
                                </svg> @extensiones
                            </Template>
                        </GridColumn>
                        <GridColumn Field=@nameof(AreaDeptoViewModel.AreTitular)
                                    HeaderText="Titular (Responsable)"
                                    HeaderTextAlign="@Syncfusion.Blazor.Grids.TextAlign.Center"
                                    TextAlign="Syncfusion.Blazor.Grids.TextAlign.Left"
                                    EditType="EditType.DefaultEdit"
                                    EditorSettings="@CustomerEditParams"
                                    Width="100px">
                            <HeaderTemplate>
                                <div>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
                                        <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3Zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                                    </svg> Titular (Responsable)
                                </div>
                            </HeaderTemplate>
                            <Template>
                                @{
                                    var titular = (context as AreaDeptoViewModel).AreTitular;
                                }
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                                    <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z" />
                                </svg> @titular
                            </Template>
                        </GridColumn>
                        <GridForeignColumn Field=@nameof(AreaDeptoViewModel.AreIdEdificio)
                                           TValue="EdificioViewModel"
                                           HeaderText="Edificio"
                                           HeaderTextAlign="@Syncfusion.Blazor.Grids.TextAlign.Center"
                                           ForeignDataSource="@oEdificio.Data"
                                           ForeignKeyField="IdEdificio"
                                           ForeignKeyValue="EdiNombreOficial"
                                           TextAlign="Syncfusion.Blazor.Grids.TextAlign.Center"
                                           ValidationRules="@(new Syncfusion.Blazor.Grids.ValidationRules { Required = true } )"
                                           EditType="EditType.DropDownEdit"
                                           AllowFiltering="true"
                                           Width="100px">
                            <HeaderTemplate>
                                <div>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-building-fill" viewBox="0 0 16 16">
                                        <path d="M3 0a1 1 0 0 0-1 1v14a1 1 0 0 0 1 1h3v-3.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5V16h3a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1H3Zm1 2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1Zm3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1Zm3.5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5ZM4 5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1ZM7.5 5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5Zm2.5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1ZM4.5 8h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5Zm2.5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1Zm3.5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5Z" />
                                    </svg> Edificio
                                </div>
                            </HeaderTemplate>
                            <Template>
                                @{
                                    var foreignKey = (context as AreaDeptoViewModel)?.AreIdEdificioNavigation;
                                    var nombreOficial = "";
                                    var nombreAlias = "";

                                    if (foreignKey != null)
                                    {
                                        nombreOficial = foreignKey.EdiNombreOficial;
                                        nombreAlias = " (" + foreignKey.EdiNombreAlias + ")";
                                    }
                                }
                                <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="currentColor" class="bi bi-building" viewBox="0 0 16 16">
                                    <path d="M4 2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1Zm3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1Zm3.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1ZM4 5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1ZM7.5 5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1Zm2.5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1ZM4.5 8a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1Zm2.5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1Zm3.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1Z" />
                                    <path d="M2 1a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V1Zm11 0H3v14h3v-2.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5V15h3V1Z" />
                                </svg> @nombreOficial<br />@nombreAlias
                            </Template>
                            @*
                        <FilterTemplate>
                        </FilterTemplate>
                        <FilterItemTemplate>
                        @{
                        EdificioViewModel? itemTemplateValue = oEdificioFilter.Data.FirstOrDefault(e => e.IdEdificio.ToString() == (context as FilterItemTemplateContext).Value.ToString());
                        }
                        @itemTemplateValue.EdiNombreOficial
                        </FilterItemTemplate>
                        *@
                            <EditTemplate>
                                @{
                                    var edificio = (context as AreaDeptoViewModel);

                                    <SfDropDownList ID="Data___AreIdEdificioNavigation"
                                                    TValue="int"
                                                    TItem="EdificioViewModel"
                                                    Placeholder="Edificio"
                                                    FloatLabelType="FloatLabelType.Always"
                                                    ShowClearButton="true"
                                                    EnableVirtualization="false"
                                                    IgnoreCase="true"
                                                    @bind-Value="@edificio.AreIdEdificio"
                                                    DataSource="@oEdificio.Data"
                                                    Enabled="true"
                                                    Readonly="false"
                                                    CssClass="e-multi-column"
                                                    AllowFiltering="true"
                                                    FilterBarPlaceholder="Selecciona una opción (Buscar por Nombre Oficial del Edificio)"
                                                    IgnoreAccent="true"
                                                    FilterType="Syncfusion.Blazor.DropDowns.FilterType.Contains"
                                                    SortOrder="Syncfusion.Blazor.DropDowns.SortOrder.None"
                                                    PopupHeight="300" PopupWidth="600">
                                        <DropDownListFieldSettings Value="IdEdificio" Text="EdiNombreOficial" />
                                        <DropDownListTemplates TItem="EdificioViewModel">
                                            <HeaderTemplate>
                                                <table>
                                                    <thead class="m-0">
                                                        <tr>
                                                            <th>Nombre Oficial del Edificio</th>
                                                            <th>Nombre Alias del Edificio</th>
                                                        </tr>
                                                    </thead>
                                                </table>
                                            </HeaderTemplate>
                                            <ItemTemplate Context="itemContext">
                                                <div class="table-responsive">
                                                    <table class="table table-bordered align-middle text-wrap text-center m-0" style="line-height: 1.5;">
                                                        <tbody>
                                                            <tr class="align-middle m-0">
                                                                <td class="m-0">
                                                                    @((itemContext as EdificioViewModel).EdiNombreOficial)
                                                                </td>
                                                                <td class="m-0">
                                                                    @((itemContext as EdificioViewModel).EdiNombreAlias)
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </ItemTemplate>
                                        </DropDownListTemplates>
                                    </SfDropDownList>
                                    <ValidationMessage For="@(() => edificio.AreIdEdificio)" />
                                }
                            </EditTemplate>
                        </GridForeignColumn>
                        <GridForeignColumn Field=@nameof(AreaDeptoViewModel.AreIdPiso)
                                           TValue="PisoViewModel"
                                           HeaderText="Piso (Nivel)"
                                           HeaderTextAlign="@Syncfusion.Blazor.Grids.TextAlign.Center"
                                           ForeignDataSource="@oPisoNivel.Data"
                                           ForeignKeyField="IdPiso"
                                           ForeignKeyValue="PisoDescripcion"
                                           TextAlign="Syncfusion.Blazor.Grids.TextAlign.Center"
                                           ValidationRules="@(new Syncfusion.Blazor.Grids.ValidationRules { Required = true } )"
                                           EditType="EditType.DropDownEdit"
                                           AllowFiltering="true"
                                           Width="80px">
                            <HeaderTemplate>
                                <div>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list-nested" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M4.5 11.5A.5.5 0 0 1 5 11h10a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5zm-2-4A.5.5 0 0 1 3 7h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm-2-4A.5.5 0 0 1 1 3h10a.5.5 0 0 1 0 1H1a.5.5 0 0 1-.5-.5z" />
                                    </svg> Piso (Nivel)
                                </div>
                            </HeaderTemplate>
                            <Template>
                                @{
                                    var foreignKey = (context as AreaDeptoViewModel).AreIdPisoNavigation;
                                    var value = "";

                                    if (foreignKey != null)
                                        value = foreignKey.PisoDescripcion;
                                }
                                <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" fill="currentColor" class="bi bi-list-nested" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M4.5 11.5A.5.5 0 0 1 5 11h10a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5zm-2-4A.5.5 0 0 1 3 7h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm-2-4A.5.5 0 0 1 1 3h10a.5.5 0 0 1 0 1H1a.5.5 0 0 1-.5-.5z" />
                                </svg>  @value
                            </Template>
                            @*
                        <FilterTemplate>
                        </FilterTemplate>
                        <FilterItemTemplate>
                        @{
                        PisoViewModel? itemTemplateValue = oPisoNivelFilter.Data.FirstOrDefault(e => e.IdPisoNivel.ToString() == (context as FilterItemTemplateContext).Value.ToString());
                        }
                        @itemTemplateValue.PisoDescripcion
                        </FilterItemTemplate>
                        *@
                            <EditTemplate>
                                @{
                                    <SfDropDownList ID="Data___AreIdPisoNavigation"
                                                    TValue="int"
                                                    TItem="PisoViewModel"
                                                    Placeholder="Piso (Nivel)"
                                                    FloatLabelType="FloatLabelType.Always"
                                                    ShowClearButton="true"
                                                    EnableVirtualization="true"
                                                    IgnoreCase="true"
                                                    @bind-Value="@((context as AreaDeptoViewModel).AreIdPiso)"
                                                    DataSource="@oPisoNivel.Data"
                                                    Enabled="true"
                                                    Readonly="false"
                                                    CssClass=""
                                                    AllowFiltering="true"
                                                    FilterBarPlaceholder="Selecciona una opción"
                                                    IgnoreAccent="true"
                                                    FilterType="Syncfusion.Blazor.DropDowns.FilterType.Contains"
                                                    SortOrder="Syncfusion.Blazor.DropDowns.SortOrder.None"
                                                    PopupHeight="" PopupWidth="">
                                        <DropDownListFieldSettings Value="IdPiso" Text="PisoDescripcion" />
                                    </SfDropDownList>
                                }
                            </EditTemplate>
                        </GridForeignColumn>
                        <GridColumn Field=@nameof(AreaDeptoViewModel.AreStatus)
                                    HeaderText="Estatus"
                                    HeaderTextAlign="@Syncfusion.Blazor.Grids.TextAlign.Center"
                                    TextAlign="Syncfusion.Blazor.Grids.TextAlign.Center"
                                    EditType="EditType.BooleanEdit"
                                    DisplayAsCheckBox="true"
                                    EditorSettings="@(EditModeSelection == true ? VerifiedEditParams : VerifiedAddParams)"
                                    DefaultValue="true"
                                    Type="Syncfusion.Blazor.Grids.ColumnType.Boolean"
                                    Width="50px">
                            <HeaderTemplate>
                                <div>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-flag-fill" viewBox="0 0 16 16">
                                        <path d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12.435 12.435 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A19.626 19.626 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a19.587 19.587 0 0 0 1.349-.476l.019-.007.004-.002h.001" />
                                    </svg> Estatus
                                </div>
                            </HeaderTemplate>
                            <Template>
                                @{
                                    var ediViewModel = (context as AreaDeptoViewModel);

                                    // <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" fill="currentColor" class="bi bi-flag" viewBox="0 0 16 16">
                                    //     <path d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12.435 12.435 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A19.626 19.626 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a19.587 19.587 0 0 0 1.349-.476l.019-.007.004-.002h.001M14 1.221c-.22.078-.48.167-.766.255-.81.252-1.872.523-2.734.523-.886 0-1.592-.286-2.203-.534l-.008-.003C7.662 1.21 7.139 1 6.5 1c-.669 0-1.606.229-2.415.478A21.294 21.294 0 0 0 3 1.845v6.433c.22-.078.48-.167.766-.255C4.576 7.77 5.638 7.5 6.5 7.5c.847 0 1.548.28 2.158.525l.028.01C9.32 8.29 9.86 8.5 10.5 8.5c.668 0 1.606-.229 2.415-.478A21.317 21.317 0 0 0 14 7.655V1.222z" />
                                    // </svg>
                                    <SfCheckBox Label="@(ediViewModel.AreStatus == true ? "Activo" : "Inactivo")" CssClass="e-success"
                                                @bind-Checked="@ediViewModel.AreStatus"
                                                @onchange="@(() => EnableDisableByCheckBox(ediViewModel.IdAreaDepto, ediViewModel.AreStatus.Value))" />
                                }
                            </Template>
                        </GridColumn>

                        <GridColumn HeaderText="Acciones" TextAlign="Syncfusion.Blazor.Grids.TextAlign.Center" AutoFit="false" Width="50px">
                            <GridCommandColumns>
                                <GridCommandColumn Type="CommandButtonType.Edit" ButtonOption="@(new CommandButtonOptions() { IconCss = "e-icons e-edit", CssClass = "e-primary e-round", IsPrimary=true })" />
                                @* <GridCommandColumn Type="CommandButtonType.Delete" ButtonOption="@(new CommandButtonOptions() { IconCss = "e-icons e-delete", CssClass = "e-danger e-round" })" /> *@
                                <GridCommandColumn Type="CommandButtonType.Save" ButtonOption="@(new CommandButtonOptions() { IconCss = "e-icons e-update", CssClass = "e-success" })" />
                                <GridCommandColumn Type="CommandButtonType.Cancel" ButtonOption="@(new CommandButtonOptions() { IconCss = "e-icons e-cancel-icon", CssClass = "e-warning" })" />
                                @* <GridCommandColumn ButtonOption="@(new CommandButtonOptions() { IconCss = "e-icons e-eye", CssClass="e-info" })" Title="Ver detalles" /> *@
                            </GridCommandColumns>
                        </GridColumn>

                    </GridColumns>
                    <GridAggregates>
                        <GridAggregate>
                            <GridAggregateColumns>
                                @*<GridAggregateColumn Field="Freight" Type="AggregateType.Sum" Format="C2">
                            <FooterTemplate>
                            @{
                            var aggregate = (context as AggregateTemplateContext);
                            <div>
                            <p>Sum: @aggregate.Sum</p>
                            </div>
                            }
                            </FooterTemplate>
                            </GridAggregateColumn>*@
                                <GridAggregateColumn Field="@nameof(AreaDeptoViewModel.AreStatus)" Type="AggregateType.TrueCount">
                                    <FooterTemplate>
                                        @{
                                            var aggregate = (context as AggregateTemplateContext);
                                            <div>
                                                <b>Habilitados: @aggregate.TrueCount</b>
                                            </div>
                                        }
                                    </FooterTemplate>
                                </GridAggregateColumn>
                            </GridAggregateColumns>
                        </GridAggregate>
                        <GridAggregate>
                            <GridAggregateColumns>
                                @*<GridAggregateColumn Field="Freight" Type="AggregateType.Average" Format="C2">
                            <FooterTemplate>
                            @{
                            var aggregate = (context as AggregateTemplateContext);
                            <div>
                            <p>Average: @aggregate.Average</p>
                            </div>
                            }
                            </FooterTemplate>
                            </GridAggregateColumn>*@
                                <GridAggregateColumn Field="@nameof(AreaDeptoViewModel.AreStatus)" Type="AggregateType.FalseCount">
                                    <FooterTemplate>
                                        @{
                                            var aggregate = (context as AggregateTemplateContext);
                                            <div>
                                                <b>Deshabilitados: @aggregate.FalseCount</b>
                                            </div>
                                        }
                                    </FooterTemplate>
                                </GridAggregateColumn>
                            </GridAggregateColumns>
                        </GridAggregate>
                    </GridAggregates>
                </SfGrid>
            </div>
        </div>
    </div>

    <SfToast @ref="@ToastObj" />
}
else
{
    <SfSpinner Type="SpinnerType.Tailwind" Size="50" Label="Cargando..." Visible="true" CssClass="e-spin-overlay" />
}

@code
{
    public void OnInput(InputEventArgs args)
    {
        this.Grid.SearchAsync(args.Value);
    }

    public Response<List<AreaDeptoViewModel>>? oResponse = new();
    public Response<List<EdificioViewModel>>? oEdificio = new();
    public Response<List<PisoViewModel>>? oPisoNivel = new();
    SfGrid<AreaDeptoViewModel> Grid = new();
    Response<object>? oRespuesta = new();
    SfToast ToastObj = new();

    public bool EditModeSelection { get; set; }
    public int GridRowHeight = 40;

    public List<AreaDeptoViewModel>? MultiSelect { get; set; }
    public List<int>? SelectedRowIndexes { get; set; }
    public int[]? TotalValue { get; set; }
    public string? SelectedValue;

    public IEditorSettings CustomerEditParams = new StringEditCellParams { Params = new TextBoxModel() { EnableRtl = false, Readonly = false, ShowClearButton = true, Multiline = false } };
    public IEditorSettings VerifiedAddParams = new BooleanEditCellParams { Params = new CheckBoxModel<bool>() { Label = "Estatus (Habilitado/Deshabilitado)", Disabled = true, LabelPosition = Syncfusion.Blazor.Buttons.LabelPosition.After } };
    public IEditorSettings VerifiedEditParams = new BooleanEditCellParams { Params = new CheckBoxModel<bool>() { Label = "Estatus (Habilitado/Deshabilitado)", Disabled = false, LabelPosition = Syncfusion.Blazor.Buttons.LabelPosition.After } };

    protected override async Task OnInitializedAsync()
    {
        oResponse = await servicioAreaDepto.GetAllDataAsync(false);
        oEdificio = await servicioEdificio.GetAllDataAsync(false);
        oPisoNivel = await servicioPiso.GetAllDataAsync(false);
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await base.OnAfterRenderAsync(firstRender);
    }

    public async Task ToolbarClick(Syncfusion.Blazor.Navigations.ClickEventArgs args)
    {
        //if (args.Item.Id == "Grid_add")
        //{
        //    var response = await servicioÁreaDepto.EnableDisableDataById(MultiSelect.Last().IdAreaDepto, false);
        //    oRespuesta = response.Content.ReadFromJsonAsync<Response<object>>().Result;
        //}
        //else if (args.Item.Id == "Grid_edit")
        //{
        //    EditModeSelection = false;
        //}
        if (args.Item.Id == "Grid_enable")
        {
            await EnableDisableByMultiSelect(true);
        }
        else if (args.Item.Id == "Grid_disable")
        {
            await EnableDisableByMultiSelect(false);
        }
        else if (args.Item.Id == "Grid_pdfexport")
        {
            PdfExportProperties ExportProperties = new PdfExportProperties();
            ExportProperties.FileName = "Áreas-Departamentos.pdf";
            ExportProperties.PageSize = PdfPageSize.Letter;
            ExportProperties.ExportType = Syncfusion.Blazor.Grids.ExportType.AllPages;
            ExportProperties.PageOrientation = Syncfusion.Blazor.Grids.PageOrientation.Landscape;
            ExportProperties.IsRepeatHeader = true;
            ExportProperties.DisableAutoFitWidth = false;
            ExportProperties.IncludeHiddenColumn = false;
            ExportProperties.IncludeTemplateColumn = true;
            await this.Grid.ExportToPdfAsync(ExportProperties);
        }
        else if (args.Item.Id == "Grid_excelexport")
        {
            ExcelExportProperties ExportProperties = new ExcelExportProperties();
            ExportProperties.FileName = "Áreas-Departamentos.xlsx";
            ExportProperties.ExportType = Syncfusion.Blazor.Grids.ExportType.AllPages;
            ExportProperties.IncludeHiddenColumn = true;
            ExportProperties.IncludeTemplateColumn = true;
            await this.Grid.ExportToExcelAsync(ExportProperties);
        }
        else if (args.Item.Id == "Grid_csvexport")
        {
            await this.Grid.ExportToCsvAsync();
        }
        else if (args.Item.Id == "small")
        {
            GridRowHeight = 20;
        }
        else if (args.Item.Id == "medium")
        {
            GridRowHeight = 40;
        }
        else if (args.Item.Id == "big")
        {
            GridRowHeight = 60;
        }
    }

    public void ExcelQueryCellInfoHandler(ExcelQueryCellInfoEventArgs<AreaDeptoViewModel> args)
    {
        if (args.Column.Field == "AreIdEdificio")
            args.Cell.Value = args.Data.AreIdEdificioNavigation.EdiNombreOficial + " (" + args.Data.AreIdEdificioNavigation.EdiNombreAlias + ")";
        else if (args.Column.Field == "AreIdPiso")
            args.Cell.Value = args.Data.AreIdPisoNavigation.PisoDescripcion;
        else if (args.Column.Field == "AreStatus")
            args.Cell.Value = args.Data.AreStatus == true ? "Habilitado" : "Deshabilitado";
    }

    public void PdfQueryCellInfoHandler(PdfQueryCellInfoEventArgs<AreaDeptoViewModel> args)
    {
        if (args.Column.Field == "AreIdEdificio")
            args.Cell.Value = args.Data.AreIdEdificioNavigation.EdiNombreOficial + " (" + args.Data.AreIdEdificioNavigation.EdiNombreAlias + ")";
        else if (args.Column.Field == "AreIdPiso")
            args.Cell.Value = args.Data.AreIdPisoNavigation.PisoDescripcion;
        else if (args.Column.Field == "AreStatus")
            args.Cell.Value = args.Data.AreStatus == true ? "Habilitado" : "Deshabilitado";
    }

    public void ExportCompleteHandler(object args)
    {
        ToastObj.ShowAsync(
            new ToastModel
                {
                    Title = "Exportación exitosa",
                    Content = "Se exportó el archivo correctamente.",
                    CssClass = "e-toast-success",
                    Icon = "e-success e-check-box", // e-meeting
                    Animation = new ToastAnimationSettings { ShowSettings = new ToastShowAnimationSettings { Effect = ToastEffect.FadeOut } },
                    Timeout = 3000,
                    ShowCloseButton = true,
                    ProgressDirection = ProgressDirection.LTR,
                    ShowProgressBar = true,
                    NewestOnTop = true,
                    Position = new ToastPosition { X = "Right", Y = "Top" }
                });
    }

    private async Task OnActionBeginHandler(Syncfusion.Blazor.Grids.ActionEventArgs<AreaDeptoViewModel> args)
    {
        if (args.RequestType == Syncfusion.Blazor.Grids.Action.BeginEdit)
        {
            // Triggers before editing operation starts
            EditModeSelection = true;
        }
        else if (args.RequestType == Syncfusion.Blazor.Grids.Action.Add)
        {
            // Triggers before add operation starts
            EditModeSelection = false;
            args.Data.AreIdEdificio = 1;
            args.Data.AreIdPiso = 1;
        }
        else if (args.RequestType == Syncfusion.Blazor.Grids.Action.Cancel)
        {
            // Triggers before cancel operation starts
        }
        else if (args.RequestType == Syncfusion.Blazor.Grids.Action.Save)
        {
            // Triggers before save operation starts
            if (args.Action == "Add")
            {
                var response = await servicioAreaDepto.AddDataAsync(args.Data);
                oRespuesta = response.Content.ReadFromJsonAsync<Response<object>>().Result;

                await ToastObj.ShowAsync(
                    new ToastModel
                        {
                            Title = "Registro Agregado",
                            Content = args.Data.AreNombre,
                            CssClass = "e-toast-success",
                            Icon = "e-success e-check-box", // e-meeting
                            Animation = new ToastAnimationSettings { ShowSettings = new ToastShowAnimationSettings { Effect = ToastEffect.FadeOut } },
                            Timeout = 3000,
                            ShowCloseButton = true,
                            ProgressDirection = ProgressDirection.LTR,
                            ShowProgressBar = true,
                            NewestOnTop = true,
                            Position = new ToastPosition { X = "Right", Y = "Top" }
                        });
            }
            else if (args.Action == "Edit")
            {
                var response = await servicioAreaDepto.EditDataAsync(args.Data);
                oRespuesta = response.Content.ReadFromJsonAsync<Response<object>>().Result;
                await ToastObj.ShowAsync(
                    new ToastModel
                        {
                            Title = "Registro Editado",
                            Content = args.Data.AreNombre,
                            CssClass = "e-toast-success",
                            Icon = "e-annotation-edit", // e-meeting
                            Animation = new ToastAnimationSettings { ShowSettings = new ToastShowAnimationSettings { Effect = ToastEffect.FadeIn } },
                            Timeout = 3000,
                            ShowCloseButton = true,
                            ProgressDirection = ProgressDirection.LTR,
                            ShowProgressBar = true,
                            NewestOnTop = true,
                            Position = new ToastPosition { X = "Right", Y = "Top" }
                        });
            }
        }
        else if (args.RequestType == Syncfusion.Blazor.Grids.Action.Delete)
        {
            // Triggers before delete operation starts
            var response = await servicioAreaDepto.EnableDisableDataById(args.RowData.IdAreaDepto, false);
            oRespuesta = response.Content.ReadFromJsonAsync<Response<object>>().Result;
            await ToastObj.ShowAsync(
                new ToastModel
                    {
                        Title = "Registro Deshabilitado",
                        Content = args.Data.AreNombre,
                        CssClass = "e-toast-danger",
                        Icon = "e-circle-remove", // e-meeting
                        Animation = new ToastAnimationSettings { ShowSettings = new ToastShowAnimationSettings { Effect = ToastEffect.FadeZoomIn } },
                        Timeout = 3000,
                        ShowCloseButton = true,
                        ProgressDirection = ProgressDirection.LTR,
                        ShowProgressBar = true,
                        NewestOnTop = true,
                        Position = new ToastPosition { X = "Right", Y = "Top" }
                    });
        }
    }

    private async Task OnActionCompleteHandler(Syncfusion.Blazor.Grids.ActionEventArgs<AreaDeptoViewModel> args)
    {
        if (args.RequestType == Syncfusion.Blazor.Grids.Action.BeginEdit)
        {
            // Triggers once editing operation completes
            args.PreventRender = false;
        }
        else if (args.RequestType == Syncfusion.Blazor.Grids.Action.Add)
        {
            // Triggers once add operation completes
            args.PreventRender = false;
        }
        else if (args.RequestType == Syncfusion.Blazor.Grids.Action.Cancel)
        {
            // Triggers once cancel operation completes
            oResponse = await servicioAreaDepto.GetAllDataAsync(false); //to fetch the updated data from db to Grid
            await PersistSelection();
        }
        else if (args.RequestType == Syncfusion.Blazor.Grids.Action.Save)
        {
            // Triggers once save operation completes
            if (args.Action == "Edit")
            {
            }

            oResponse = await servicioAreaDepto.GetAllDataAsync(false); //to fetch the updated data from db to Grid
            await PersistSelection();
            StateHasChanged();

            if (args.Action == "Add")
            {
                await (Grid.TotalItemCount % Grid.PageSettings.PageSize == 0 ?
                        Grid.GoToPageAsync(Grid.TotalItemCount / Grid.PageSettings.PageSize) :
                        Grid.GoToPageAsync((Grid.TotalItemCount / Grid.PageSettings.PageSize) + 1));

                await (Grid.TotalItemCount % Grid.PageSettings.PageSize == 0 ?
                        Grid.SelectRowAsync(Grid.PageSettings.PageSize - 1) :
                        Grid.SelectRowAsync((Grid.TotalItemCount % Grid.PageSettings.PageSize) - 1));
            }
        }
        else if (args.RequestType == Syncfusion.Blazor.Grids.Action.Delete)
        {
            // Triggers once delete operation completes
            oResponse = await servicioAreaDepto.GetAllDataAsync(false);
            await PersistSelection();
        }
    }

    private async Task EnableDisableByCheckBox(int id, bool isActivate)
    {
        try
        {
            var response = await servicioAreaDepto.EnableDisableDataById(id, isActivate);
            oRespuesta = response.Content.ReadFromJsonAsync<Response<object>>().Result;

            if (MultiSelect != null && isActivate)
                await ToastObj.ShowAsync(
                    new ToastModel
                        {
                            Title = "Registro Habilitado",
                            Content = MultiSelect.Last().AreNombre,
                            CssClass = "e-toast-success",
                            Icon = "e-circle-check",
                            Animation = new ToastAnimationSettings { ShowSettings = new ToastShowAnimationSettings { Effect = ToastEffect.ZoomIn } },
                            Timeout = 3000,
                            ShowCloseButton = true,
                            ProgressDirection = ProgressDirection.LTR,
                            ShowProgressBar = true,
                            NewestOnTop = true,
                            Position = new ToastPosition { X = "Right", Y = "Top" }
                        });
            else if (MultiSelect != null && !isActivate)
                await ToastObj.ShowAsync(
                    new ToastModel
                        {
                            Title = "Registro Deshabilitado",
                            Content = MultiSelect.Last().AreNombre,
                            CssClass = "e-toast-danger",
                            Icon = "e-circle-remove",
                            Animation = new ToastAnimationSettings { ShowSettings = new ToastShowAnimationSettings { Effect = ToastEffect.ZoomOut } },
                            Timeout = 3000,
                            ShowCloseButton = true,
                            ProgressDirection = ProgressDirection.LTR,
                            ShowProgressBar = true,
                            NewestOnTop = true,
                            Position = new ToastPosition { X = "Right", Y = "Top" }
                        });
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
        }
        finally
        {
            oResponse = await servicioAreaDepto.GetAllDataAsync(false);
            await PersistSelection();
        }
    }

    public async Task EnableDisableByMultiSelect(bool isActivate)
    {
        try
        {
            string reg = string.Empty;

            if (MultiSelect != null)
                foreach (var item in MultiSelect)
                {
                    var response = await servicioAreaDepto.EnableDisableDataById(item.IdAreaDepto, isActivate);
                    oRespuesta = response.Content.ReadFromJsonAsync<Response<object>>().Result;
                    reg += "<b>" + item.IdAreaDepto + "</b> " + item.AreNombre + "<br>";
                }

            if (MultiSelect != null && isActivate)
                await ToastObj.ShowAsync(
                    new ToastModel
                        {
                            Title = "Registros Habilitados",
                            Content = reg,
                            CssClass = "e-toast-success",
                            Icon = "e-circle-check",
                            Animation = new ToastAnimationSettings { ShowSettings = new ToastShowAnimationSettings { Effect = ToastEffect.ZoomIn } },
                            Timeout = 3000,
                            ShowCloseButton = true,
                            ProgressDirection = ProgressDirection.LTR,
                            ShowProgressBar = true,
                            NewestOnTop = true,
                            Position = new ToastPosition { X = "Right", Y = "Top" }
                        });
            else if (MultiSelect != null && !isActivate)
                await ToastObj.ShowAsync(
                    new ToastModel
                        {
                            Title = "Registros Deshabilitados",
                            Content = reg,
                            CssClass = "e-toast-danger",
                            Icon = "e-circle-remove",
                            Animation = new ToastAnimationSettings { ShowSettings = new ToastShowAnimationSettings { Effect = ToastEffect.ZoomOut } },
                            Timeout = 3000,
                            ShowCloseButton = true,
                            ProgressDirection = ProgressDirection.LTR,
                            ShowProgressBar = true,
                            NewestOnTop = true,
                            Position = new ToastPosition { X = "Right", Y = "Top" }
                        });
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
        }
        finally
        {
            oResponse = await servicioAreaDepto.GetAllDataAsync(false);
            await PersistSelection();
        }
    }

    public async Task PersistSelection() => await (TotalValue != null && TotalValue.Length > 0 ? Grid.SelectRowsAsync(TotalValue) : Grid.SelectRowAsync(0));

    public async Task GetSelectedRecords(RowSelectEventArgs<AreaDeptoViewModel> args)
    {
        //MultiSelect = null;

        MultiSelect = await this.Grid.GetSelectedRecordsAsync();

        SelectedRowIndexes = await this.Grid.GetSelectedRowIndexesAsync();
        TotalValue = SelectedRowIndexes.ToArray();
        SelectedValue = "";
        if (TotalValue.Length > 0 && SelectedRowIndexes.Count > 0)
            foreach (var data in TotalValue)
            {
                SelectedValue = SelectedValue + " " + data;
            }
    }

    public async Task GetDeselectedRecords(RowDeselectEventArgs<AreaDeptoViewModel> args)
    {
        MultiSelect = await this.Grid.GetSelectedRecordsAsync();

        SelectedRowIndexes = await this.Grid.GetSelectedRowIndexesAsync();
        TotalValue = SelectedRowIndexes.ToArray();
        SelectedValue = "";
        if (TotalValue.Length > 0 && SelectedRowIndexes.Count > 0)
            foreach (var data in TotalValue)
            {
                SelectedValue = SelectedValue + " " + data;
            }
    }

    public void OnCommandClicked(CommandClickEventArgs<AreaDeptoViewModel> args)
    {
        //if (args.CommandColumn.ButtonOption.Content == "Detalles")
        //    args.RowData;
        //Console.WriteLine(args.RowData.IdAreaDepto);
    }
}

